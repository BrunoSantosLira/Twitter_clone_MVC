<nav class="navbar navbar-expand-lg menu">
	<div class="container">
	  <div class="navbar-nav">
	  	<a class="menuItem" href="/timeline">
	  		Home
	  	</a>

	  	<a class="menuItem" href="/sair">
	  		Sair
	  	</a>
			<img src="/img/twitter_logo.png" class="menuIco" />
	  </div>
	</div>
</nav>

<div class="container mt-5">
	<div class="row pt-2">
		
		<div class="col-md-3">
			<!-- <img width="255px" height="95px" src="<?//php echo $this->view->foto_perfil['foto_perfil'] ?>" alt=""> -->
			<div class="perfil">
					<form name="arquivo1" id="arquivo1" method="post" enctype="multipart/form-data" action="\foto_edit?id=<?php echo $_SESSION['id'] ?>" class="text-center" >
						<label for="arquivo"> 
							<i class="fa-solid fa-pen"></i>
						</label>
						<input type="file" name="arquivo" id="arquivo" value="SELECT">
					</form>
				<div class="text-center" style="margin-bottom: 15px;">
					<img id="foto_perfil" src="<?php echo $this->view->foto_perfil['foto_perfil'] ?>" style="width: 100; height: 100; border: 1px solid red; border-radius: 60px; padding:;">
				</div>
				
				<div class="perfilPainel">
					
					<div class="row mt-2 mb-2">
						<div class="col mb-2 text-center">
							<span class="perfilPainelNome"><?php echo $this->view->info_usuario['nome'] ?></span>
						</div>
					</div>

					<div class="row mb-2">

						<div class="col">
							<span class="perfilPainelItem">Tweets</span><br />
							<span class="perfilPainelItemValor"><?php echo $this->view->total_tweets['total_tweets'] ?></span>
						</div>

						<div class="col">
							<span class="perfilPainelItem">Seguindo</span><br />
							<span class="perfilPainelItemValor"><?php echo $this->view->total_seguindo['total_seguindo'] ?></span>
						</div>

						<div class="col">
							<span class="perfilPainelItem">Seguidores</span><br />
							<span class="perfilPainelItemValor"><?php print_r ($this->view->total_seguidores['total_seguindo'])?></span>
						</div>

					</div>

				</div>
			</div>

		</div>

		<div class="col-md-6">
			<div class="row mb-2">
				<div class="col tweetBox">
					<form name="arquivo2" id="arquivo2" method="post" action="/tweet" enctype="multipart/form-data">
						<textarea class="form-control" name="tweet" id="exampleFormControlTextarea1" rows="3"></textarea>
						
						<input type="file" name="arquivo2" id="arquivo2" value="arquivo2">

						<?php if (isset($_GET['img_erro']) && $_GET['img_erro'] == 'formatoInvalido') { ?>
							<p class="text-danger text-formted">Tipo de formato inválido!!! Por favor, adicione um png ou jpg.</p>
						<?php } ?>
						<?php if (isset($_GET['img_erro']) && $_GET['img_erro'] == 'tamanhoMaximoUltrapassado') { ?>
							<p class="text-danger text-formted">MAX: 2mb</p>
						<?php } ?>

						<div class="col mt-2 d-flex justify-content-end">
				
							<button type="submit"  class="btn btn-primary">Tweet</button>
						</div>

					</form>
				</div>
			</div>
			<?php
			echo '<pre>';
			echo '</pre>'; ?>

			<?php foreach ($this->view->tweets as $key => $tweet) { ?>
			<div class="row tweet">
				<div class="col">
					<p>
						<!-- Foto do perfil --><img style="width: 50px; height: 50px; border-radius:25px;" src="<?php echo $tweet['foto_perfil'] ?>" alt="">

						<strong><?php echo $tweet['nome'] ?></strong> <span class="text text-muted">- <?php echo $tweet['data'] ?></span>
					</p>
					<p><?php echo $tweet['tweet']?> </p>
					<?php if ($tweet['path_imagem'] != null  ) { ?>
						<img width="350px" src="<?php echo $tweet['path_imagem'] ?>" alt=""><br/>
						<a href="<?php echo $tweet['path_imagem']  ?>" target="_blank" rel="noopener noreferrer">Ver imagem -> </a>

					<?php } ?>
						
					<br />
					<?php if($tweet['id_usuario'] == $_SESSION['id']){ ?>
					<form method="post" action="\remover_tweet?id=<?php echo $tweet['id'] ?>">
						<div class="col d-flex justify-content-end">
							<button type="submit" class="btn btn-danger"><small>Remover</small></button>
						</div>
					</form>
					<?php } ?>
						
				</div>
			</div>
			<?php } ?>
			<div class="row">
				<nav aria-label="...">
					<ul class="pagination">

						<li class="page-item"><a class="page-link" href="?pagina=1">Primeira</a></li>

						<?php for ($i = 1; $i <= $this->view->total_paginas; $i++){ ?>
							<li class="page-item <?php echo $this->view->pagina_ativa == $i ? 'active' : ''
							 ?>">
							 <a class="page-link" href="?pagina=<?php echo $i ?>"><?php echo $i ?></a>
							</li>
						<?php } ?>

						<li class="page-item">
						<a class="page-link"  href="?pagina=<?php echo  $this->view->total_paginas?>">Última</a>
						</li>

					</ul>
				</nav>
			</div>
		</div>


		<div class="col-md-3">
			<div class="quemSeguir">
				<span class="quemSeguirTitulo">Quem seguir</span><br />
				<hr />
				<a href="\quemSeguir" class="quemSeguirTxt">Procurar por pessoas conhecidas</a>
				<!-- <a href="/img/img.png">IMG </a> -->
			</div>
		</div>

	</div>
</div>
<script>
	document.getElementById('arquivo').onchange = function(e){
		var foto_perfil = document.getElementById('foto_perfil');
		if(e.target.files != null && e.target.files.length != 0){
			var arquivo = e.target.files[0];
			var fd = new FormData();

			fd.append("arquivo", arquivo);
			var ajax = new XMLHttpRequest();

			ajax.onreadystatechange = function(){
				if(ajax.readyState == 4 && ajax.status == 200){
					try{
					let path_img = JSON.parse(ajax.responseText);
					foto_perfil.src = path_img.foto_perfil;

					}catch($Error){
						alert('Formato não permitido')
					}
				}
			}

			ajax.open("POST",'\\foto_edit?id=<?php echo $_SESSION['id'] ?>',true)
			ajax.send(fd);
		}
	}

	
</script>